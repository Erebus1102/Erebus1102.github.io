---
title: Product - 1 - Defi蓝筹
tags:
  - Crypto
  - Financial
  - Transaction
---
# 1. ETH & Smart contract
## 1.1. ETH
### 1.1.1. ETH 的基本信息
>[!TIP] ETH 背后的主要思想：
>开发者可在分布式网络上创建和运行代码，而并非在中央服务器上。Ethereum（以太坊）的代码是在分布式系统中运行的。当代码被添加到 Ethereum 数据库中（即区块链）后，则代码更不可能被修改。此外数据库的所有人可见则允许你在交互之前进行代码审查。
- **定义**：以太坊(Ethereum) 是一个去中心化的计算平台，以同时在世界各地的数千台设备上运行，而这也就意味不存在唯一拥有者
- **功能**：数字资产转移、可以配置自己的代码，并与其他应用程序进行交互
- Smart Contracts（智能合约）：构成以太坊上应用的编程，Smart Contract（智能合约）就是代码。它不是传统意义上的契约。其中的 Smart 代表智能，也就是特定条件下的自我执行。而之所以被视为Contract（合约），是因为它执行ਂ方之间的协议。
	*“Ethereum”指的是协议本身，而作为动力的代币则被称为 Ether（以太币 or ETH）*
### 1.1.2. ETH 与 BTC
- **BTC：Bitcoin 被认为是第一代区块链**
	- **优势：** 并不是作为复杂系统而创建的，而这也造就了它在安全方面的优势。有意地非灵活性则优化了基础层的安全性
	- **劣势：** Bitcoin 中智能合约的语言是受限制的，因此并不能很好的适应交易外的应用程序
- **ETH：第二代区块链**
	- **优势：** 除了金融交易之外，那些平台还提供了更高程度的可编程性。Ethereum 为开发者们提供了更多的自由，允许他们可使用自己的代码来创建更多的去中心化应用程序（DApps）
	- **互联网中的开放协作（Open collaboration）概念**：DAOs（去中心化自治组织），类似于计算机程序，完全由计算机代码控制。“The DAO”是由一些复杂的智能合约组成，并作为独立风险基金运作。而 DAO 代币则是以 ICO 形式分配，并授予代币持有者股份所有权和投票权
	- **以太坊的硬分叉：** 以太坊在遭受黑客攻击后 Ethereum 硬分为两条链。
		- Ethereum Blockchain（以太坊区块链）：一条分链中恶意交易被逆转以恢复资金
		- Ethereum Classic（以太坊经典）：另一条分链中的交易没被逆转保持不变
### 1.1.3.  Etherum Gas
- **定义：** 通过 ETH Gas 规避由于大量用户同时挤占网络或无限期运行，矿工的主要动机是收益，因此他们将忽略费用较低的交易
- **Gas 的应用：** 如果网络拥挤且很多用户都在试图交易的话，gas 的价格就会上涨。在可以手动设置愿为单位 gas 支付的费用（gas Price），以该笔交易可消耗的最大 gas 量（gas limit）。*gas price 决定矿工打包交易的速度，而 gas limit 则决定你愿意为此交易支付的最多 gas 量*
- **度量方式：** gas 就成为了算力的度量基础，使用更小的单位“gwei”来表示。1 gwei 相当于十亿分之一的 Ether。*简单来说，你的确可以运行一个长时间循环的程序，但此操作很快将变得非常昂贵。这样 Ethereum 中的节点就可以缓解网络中的垃圾信息了。*
### 1.1.4. ETH 代币、扩容、ETH 发表前景
#### ETH 代币
>[! Tip] Ethereum 允许用户在链上创建自己的资产，并且这些资产可以像 Ether 一样进行存储和转移。开发者们可以在智能合约中对资产管理规则以代币参数进行设定。
- 其中包括*代币发行量，代币发行机制，是否可被分割，是否可替换等*
- 在 Ethereum 上创建的代币都需要符合 ERC-20 技术标准，因此这些代币也被称为 ERC-20 代币
#### 扩容
>[! Tip] 加密货币中的可扩展性（scalability）
>	指的是区块链可扩展容那更多用户的程度。其中的更多用户意味着区块链将涉更多的操作和交易竞争
- **扩容的必要性：**
	- 积压：当当前的交易达到 ETH 一个区块的 gas limit 时，任何其他的交易都需要等待下一个区块
	- 价格上涨：交易者就不得不支付更高价格来使自己的交易被优先处理
- **扩容的局限（扩容、安全、去中心化的不可能取其三）：**
	- **安全性和去中心化：** Ethereum 和 Bitcoin 等区块链都*将安全性和去中心化放在了首位*。它们的共识算法确保了网络的安全性，但其中的网络是由成千上万的节点组成，所以降低了网络的可扩展性。由于接收和验证交易都是由众多节点来完成的，所以相比于中央式方案要慢的多。
	- **安全且可扩展：** 移除区块的 gas limit，这样的网络则同时具有安全性和可扩展性，但不再是去中心化. 假如此种方式持续下去，则仅会有少部分强大的节点幸存，而这就导致了系统的更加中心化。*最后你会得到一个安全且可扩展的区块链，但并会去中心化*。
	- **去中心化和可扩展性：** 网络牺牲了共识算法来实现更快的速度和去中心化，而结果却是安全性降低了
#### 未来
>[! Tip]  
>- Ethereum 的拥护者认为下一代 ETH 将带来一套分布式拓补结构，不再需要中间商、会更注重隐私性，并最终转向数据的自我拥有。
>- 而这些基础属性将*通过分布式存储/通讯协议和智能合约式的分布式计算来构建。* 而为了实现之这一目标，Ethereum 需要*在不损害去中心化的前提下，大规模提升网络处理交易的能力。*
>- 目前，Ethereum 并未像 Bitcoin 那样通过限制区块大小来限制交易量。而只是向区块中纳入了 gas limit（单一区块中可容纳最大 gas 量）
- **Ethereum Sharding:**  将网络划分为不同节点子集，也就是所谓的 shards（分片）。*每一个分片都将处理自己的交易和合约，同时也会按照要求与其他网络的分片进行通信*。并且由于每个分片都将独立验证，所以它们不需要存储其他分片的数据。 
- **Ethereum POS:**  权益证明（PoS）是工作量证明（PoW）替代方案，用来验证区块。在 PoS 系统中新区块并不是通过挖矿来获得，*而是通过铸造（有时也被称为锻造）来完成*。矿工不再需要通过算力来竞争。现在的候选区块是由周期性随机选择出的节点（验证者）来完成验证的。如果操作正确，则该节点将会获得区块中所有的交易费用，有时也可能根据协议获得区块奖励。 
- **Ethereum Plasma:**  一种链下扩容解决方案。顾名思义，也就是*将交易脱离区块链以便于提高网络吞吐量。* 此时的它就与侧链和支付通道有些相似。
### 1.1.5. ETH 的产出
>[!TIP]
>- 理解需求，理解供应=理解 ETH 的价值
>- ETH 还有很多有意思的叙事/升级，给投机带来了很多可能性
#### 2022年9月 - ”The Merge”
- **产出内容**：以太坊执行层和信标链合并，产出第一个 PoS 区块。自此，以太坊正式从 PoW（显卡挖矿）转换为 PoS 共识机制。
- **影响**：利好释放即利空，当周下跌超20%
#### 2023年3月 - 上海升级
- **产出内容**：上海升级将部署 EIP-4895 提案，主要内容是解决质押在信标链上的以太币的提款问题。部署完成后，用户便可以取回质押在信标链上的以太币，但在上海升级前，用户只能存入不能提取。
- **影响：** [Qualimint - YouTube](https://www.youtube.com/@Qualimint)
# 2. 交易所和钱包
## 2.1 交易所（Exchange）
**定义：** 交易加密货币，使用衍生品，不是你存币的地方
- 中国：okx，binance （人民币入金）
- 美国：coinbase，robinhood（美元入金）
- 加拿大：coinbase, virgocx，bitbuy（加元入金）
### 交易所大事记
- 门头沟
- QuadrigaCX-2019 年“假死”
- Fcoin-2020“被盗”
- FTX-2022 挪用用户资金，巨大亏空
## 2.2 钱包（Wallet）
- Hot Wallet (热钱包)：以某种方式与互联网连接的加密货币钱包被称为热钱包。
- Cold Wallet（冷钱包）：冷钱包则是一种不暴露在互联网当中的加密钱包。
# 3. 稳定币
- **稳定币的定义：** 稳定币是在区块链上发行的数字代币，与传统货币挂钩，保持相对稳定的价值
- **稳定币的存在目的：** 减少价格波动，使交易和结算能够以美元计价在某些交易所和去中心化交易所进行
- **稳定币的交易环境：** 以美元计价在某些交易所和去中心化交易所进行
- **稳定币的现状：** 目前加密货币市场上有 50 多种稳定币，泰达币（USDT）和 USDC 是市场份额最大的两种稳定币，其中 USDT 在交易者中特别受欢迎
![[content/notes/images/1698854626393.png]]
## 3.1  Fiat-backed 法币抵押
>[!info] 
>- Risk/相关风险：
>	- Counterparty risk
>	- Government regulation
>	- Freezable
>- Benefit/相关益处：
>	- The most stable
>	- The most scalable
>	- Easy to track

稳定币系统可以想象成一个全储备银行系统（full-reserve banking system），在全储备银行中，每个负债都与储备资产以1:1的比例匹配。如果持有数字美元的人想要兑换成现金，银行将提供实体美元并"销毁"相应的数字债务。
- 资产负债表的左侧是银行的实际资产，即作为储备的实体美元。
- 资产负债表的右侧是银行的负债（"数字美元"），即对储备资产的索取权。
### USDT
- 概述：
	- Tether 是为面临传统银行系统困难的比特币交易和交易所提供的最佳解决方案
	- 每个 USDT 都由 Tether Ltd 储备的一美元支持，并可通过 Tether 平台兑换
	- USDT 可以用于转账、存储和支付，就像比特币或其他加密货币一样，允许用户在钱包中交易和存储 USDT
- 目的：
	- 创建 USDT 和其他 Tether 货币旨在促进法定货币的流通，为用户提供比特币的稳定对应物，并支持不能信任的钱包的现金兑换和价值审计
	- USDT 通过价值储备提供替代的偿付能力证明
- 透明度和审计：
	- Tether Ltd 在其网站的透明度页面上公布其银行信息，以证明其银行账户中的美元金额等于或超过 USDT 的流通供应；
	- 专业审计师定期验证、签署并发布银行余额信息和财务报表，以确保透明度和问责制；
## 3.2. Crypto-backed 加密资产抵押
>[!info] 
>- Risk/相关风险：
>	- Less stable
>	- harder to scale
>	- Robustness in large-drawdown
>- Benefit/相关益处：
>	- Decentralized
>	- Censorship resistant

- 如何创建一个以资产储备为基础的稳定币银行：
	1. 用现金资产换取等值的加密货币资产作为储备
	2. 考虑到加密货币价格波动性，1:1的储备比率无法提供充足的保障。如果价格下跌，银行就可能出现负债超过资产的情况 (即抵押不足)，造成稳定币脱钩
	3. 增加缓冲区以抵御加密货币价格下跌并保护资产。这个概念与 MakerDAO 的模型类似，它会要求借款人质押一定比例的加密资产，这样价格下跌时抵押品仍能覆盖债务。**所以通常加密资产抵押的储备比率会高于1:1（如 110%或 120%），以调控短期价格波动**
	4. 通过这种充分储备的模式，银行能够提供更稳定的稳定币，同时避免负债风险
- Buffer/缓冲区：专业术语为“抵质押比率/Collateralization ratio”，它决定了每一个单位的稳定币需要多少加密资产作为抵押支撑。「例如, 150%的抵质押比率意味着每 1 美元的流通稳定币，至少需要价值 1.5 美元的加密资产作为抵押」。
	- 这种设计保证即使加密货币价格下跌，抵质押资产的价值也能支持稳定币的价值。这样稳定币可以保持债务稳定，银行也可以保持充分抵押状态。
### DAI -- MakerDao 发行的稳定币
>[!info] 
>USDT\USDC 所存在的问题与传统金融行业中的问题相似，法币抵押稳定币的价格依赖于社会体系以及法律体系。
>	若银行资产被冻结、审计、会计存在欺诈行为等等（如 SVB），则用户手中的稳定币就变成了 “I own you” 的借条，因此法币抵押也被称为 “IOU” 模式。
>	同时当区块链上的公司计划实行相同的模式时，会引入非常多不被信任的中间商（会计、审计等）这样的机制不太符合 Web 3.0 “去中心化自治” 的要点。
	- Dai 是通过抵押加密资产在 MakerDAO 平台上发行的稳定币。
	- Dai 与美元挂钩（peg），所以 1 Dai 等于 1 美元。

- **MakerDao 的核心机制**：担保债务头寸 (CDP/Collateralized Debt Position)。
	- 假设申请者向银行申请房贷，申请过程中使用房产作为抵押，银行提供现金贷款。如果房产价值下降，则银行将要求申请者偿还贷款。如果申请者无法偿还贷款，银行将收走您的房产。
	- 对 Maker 来说，以太坊就像房产，智能合约就像银行，Dai 就像贷款。ETH 持有者将以太坊存入 CDP 智能合约，并获得 Dai 作为贷款。*如果持有者抵质押的以太坊价值下跌至一定阈值以下，要么像银行贷款那样偿还智能合约贷款，要么智能合约收走以太坊并竞拍出售。*

-  **如果以太坊价值上升：** 抵质押率将增加，Dai 价值也将上涨。如果 Dai 交易价格超过 1 美元。Maker 通过机制激励用户创建更多 Dai。
- **如果以太坊价值下跌：** 如果抵质押的以太坊价值无法支持相应数量的 Dai, Dai 价值将低于 1 美元, de-peg 系统可能崩溃。
	解决方法：Maker 将在所持有的 ETH 价值无法支持 Dai 价格*前*清算 CDP，并将以太坊竞拍出售。
		如果 CDP 中的价格显示 ETH 价值下跌至创建 Dai 代币对应的一定阈值 (比如 125%)以下，CDP 将被“清算”，CDP 中的以太坊将竞拍出售（Auction Process）直到偿还借出的 Dai 为止。
- Auction Process：
	- 生成 DAI 后，Vault 的所有者可以收回 DAI 从而提取质押的数字资产。此时收回的 DAI 也将被系统销毁，以维持抵押品价值和流通中的 DAI 价值之间的平衡。
	- 在销毁-回收流程之前。必须支付稳定费/Stability Fee（可以理解为贷款的利息/interest on the loan）

	> **Example:**
> <span style="background:#930098">假设：</span>
> - <span style="background:#930098">Stability fee = 2% (这笔钱收取后会存放到 Buffer Pool 中，Buffer Pool 不属于任何人，Work as reserve fund)</span>
> - <span style="background:#930098">Collateralization Ratio 联合质押率 = 150%</span>
	- 初始状态：$1\ ETH = \$ 3500 = generated => 2000 DAI$ 
	- **若：** $1\ ETH 下跌到 \$\ 2900$ ，则此时 1 Ether 能铸造的最大 DAI 数量为：$2900/150\% = 1933$ 
	此时生成的 2000 个 DAI 超过了系统允许的 1933 个，则此 Vault（CDP）就将被清算来还掉欠的 2000 个 DAI，**同时还需要缴纳一笔清算的罚款** （13% ~ 33%，该区间由 MKR token holders 投票决定）。
	具体的罚款值由拍卖的单价决定，拍卖价格越高，持有者的损失越少，则罚款也就越少。
$$
\begin{gather}
The\ liquidation\ price = number\ of\ DAI * liquidation\ ratio = 2000 * 150\% = $ 3000 \\
即：当以太坊的价格跌至 3000 以下的时候，系统就将进行清算\\
The\ liquidation\ penalty = least\ 13\% * the\ liquidation\ price = 3000*13\% = 390\ DAI\\
Total\ outstanding\ debt = the\ liquidation\ penalty\ +\ number\ of\ DAI  = 2000+390 = 2390\ DAI\\
机制目的: Total\ Colleteral > Total\ outstanding\ debt
\end{gather}
$$此时系统的抵押物为 1 ETH，而系统负债为 2390 DAI
要求确保出价能够覆盖负债，因此整个拍卖过程包含两个阶段：

| Phase 1 “Setting Price” (保证债务能 Cover)   | Phase 2 “negotiation” (减少被清算者损失)     |
| ------------------------------------------- | -------------------------------------------- |
| 2000 DAI for 1 ETH                          | For 2390 DAI, 出价 0.95 ETH                   |
| 2200 DAI for 1 ETH                          | For 2390 DAI, 出价 0.90 ETH                   |
| 2400 DAI for 1 ETH -> 满足 outstanding debt | For 2390 DAI, 出价 0.87 ETH -> 没有更低出价者 |

假设此时出价者通过 0.87 ETH，拍卖得到 2390 个 DAI。其中 2000 DAI 被用于还款，而 390 DAI 被用于缴纳罚款。此时竞拍者获得的 ETH 的实际价值高于 2390 DAI 或对应的每 ETH 高于 $2390/0.87 = \$2747 $，而此时 ETH 的售价为$ 2900，则此时竞拍者获利。

------

**罚款比例的计算：**

在本次清算（Liquidation）中，持有者将一个 ETH（价值\$3000）生成了 2000 DAI，而清算结束后他持有 2000 个 DAI 和 0.13（价值\$390）个 ETH，总亏损为 $\$610\  (=3000-2000-390)$，此时的罚款比例为 $20.33\%\ (=610/3000)$。

如果想进一步降低被清算者的损失，假设有竞拍者使用 0.797 个 ETH 拍得 3000 个 DAI，则此时的罚款比例达到了最低的 13%。

而如果在第一阶段叫到 2390 DAI 便结束，而第二阶段无人继续叫价，则用户会面临 Full liquidation (利用 1 ETH 全部偿还 2390 DAI)，此时他将拥有 2000 DAI 和 0 ETH，总损失 1000，罚款比例为 $33\%\ (=1000/3000)$。

------

**当以太坊继续暴跌的情况下…：**

若以太坊继续暴跌，假设一阶段最高报价为\$1500，则此时 CDP 全部清空后持有者将持有 2000 DAI + 0 ETH，而此时系统的 OutStanding Debt 为 $\$890 DAI (=2390-1500)$。此时 Vault 中没有任何资产可以用来清算，而系统处于欠债情况，则此时需要 Buffer Pool 参与工作。

系统会将 Buffer Pool 中对应金额的 DAI 拿出来销毁掉以补足欠债；

当 Buffer Pool 中的 DAI 依然不足以偿还债务的时候，Debt Protocol 会被激活。系统会生成 MKR 代币进行拍卖，直到拍卖价格补足 Outstanding debt。

> Q：那 MKR 是否就是没有价值，只是机构用于印钞抵债的骗局工具的呢？
> A：当正常情况下，Buffer Pool 通过 Stability fee 和 Liquidation Penalities 是在不断积攒的，在这种情况下机构会从 Buffer Pool 中取出 DAI 来购买流通市场上的 MKR 并销毁掉，从而保证流通市场上 MKR 的价值属性。

------
**The DAI Saving Rate （DSR）：**

用户可以将自己持有的 DAI 存入 DSR 合约中来赚取利息，其实就是将 DAI 存入 Buffer Pool 中来积攒机构的风险抵抗能力，同时可以鼓励用户持有 DAI；

当市场上的 DAI 流通量过高导致 DAI 的单价低于 $1，机构可以提高 DSR 的利率来吸引用户将 DAI 存入 Buffer Pool，通过这种方式降低市场上的流动率从而提高单价；相反当 DAI 的单价过高的时候，机构可以选择降息。

**Peg Stability Module（PSM）与 MakerDAO 在 2023/3 脱锚的原因**
	- MakerDAO 的 PSM 是：一种允许用户以零成本将法币支持的稳定币与\$DAI 交换的工具；
	- 使用 PSM 模块不会将你的法币支持的稳定币抵押在金库中，而是直接将它们兑换成\$DAI，用户也可以将\$DAI  兑换成 PSM 模块，并获得法币支持的稳定币；
	- PSM 加强了\$DAI 和美元之间的联系，允许 Traders 利用\$DAI 和其他法币支持的稳定币之间的价格差异套利；

  PSM 改变了 MakerDAO 的资产负债表。

|                    Asset                     |   Liability    |
| :------------------------------------------: | :------------: |
| Loan from minting DAI (secured by ETH, WBTC) | DAI (from CDP) |
|     Fiat-backed stablecoins (USDC, USDP)     | DAI (from PSM) |

  * **PSM 的问题：** 由于现在生成 DAI 的对应资产中 [37.2%（最大份额)]( https://daistats.com )是 USDC（通过 PSM）直接兑换而来，而 USDC 的 Swap 并不能像 ETH/BTC 一样产生 Stability fee 和 Penalty fee，从而导致 DAI 也承受 USDC 的风险。

    即：如果 USDC 收到影响，而大量的 Swap 过程没有给 Buffer Pool 带来足够的增量，DAI 也会承受来自 USDC 的压力。

  * **PSM 的补足手段：**

    由于 PSM 工具的 Allowance 有一个 hardcap 上限，当达到这个上限的时候用户只能用 1 DAI 换 1 USDC，但不能用 1 USDC 换 1 DAI，这确保了 DAI 的数量不会疯狂上涨造成贬值，从而确保了 DAI 的价值不会低于 USDC 的价值；

    Example：有非常多的交易员通过做多 DAI，做空 USDC 来赚取价差。只要 USDC 价格跌幅大于 DAI 的价格跌幅，这之间的差距就可以保证该策略有效盈利。

    如果 USDC 贬值（如\$0.98），MakerDAO 通常会增加铸币费来维持 USDC 与 DAI 直接价格的锚定（即增加 PSM 工具的使用费用来注入 Buffer Pool）。在某些情况下，MakerDAO 可能需要吸收与这些债务有关的损失，以确保 DAI 价格的稳定。
    在极端情况下，如市场崩溃，借款人可能会购买 DAI 来偿还他们的债务。这将导致对 DAI 的需求大幅增加，从而推高其价格。在这种情况下，PSM 可以帮助平衡市场，提供一种机制，允许用户以固定利率交换 DAI 和 USDC，从而促进 DAI 价格的稳定。

* **RWA  （Real World Asset）**
  * RWA 是 MakerDAO 的一种新概念，它代表了 MakerDAO 投资于现实世界资产的价值。
  * 考虑到$USDC 是由美元存款和美国政府债券支持的，直接投资于美国政府债券可以减少风险，并且基本上价值相似的资产。
  * MakerDAO 设计了一个信托结构来间接持有现实世界的资产，这样做可以降低 MakerDAO 的风险，并增加其收入。
  * MakerDAO 的 RWA 概念的 token 是 MKR，它是一种能够给协议带来盈利能力的 token。

## 3.3. Algorithmic Stablecoins 算法稳定币
>[!info] 
>- Risk/相关风险：
>	- Highly theoretical and not tested out in practice
>- Benefit/相关益处
>	- Potentially decentralized：
算法稳定币使用价格稳定算法来跟踪一个特定的单位价格，通常是 1 美元，并在以太坊（ETH）等基础加密货币支持的区块链上运行。

- 算法稳定币的价格由基于智能合约的市场和技术机制支持，这些机制锁定了加密货币抵押品并实施价格稳定算法。
- 与其他类型的稳定币不同，算法稳定币不能以1:1的比例兑换美元，也没有其他加密货币资产的支持。它们通常表现出高度的反身性。
- 对算法稳定币的需求主要由市场情绪和趋势驱动，这也影响到代币供应。

### **AMPL--Ampleforth 是目前运行时间最长的算法稳定币**

- AMPL 的代币供应量根据目标资产的价格变化而变化（这种机制被称为 "rebase"）。
- 代币供应的变化会影响到持有算法稳定币的每个账户。"rebase"通常发生在预定的时间间隔内，使算法稳定币网络具有高度的反身性。
- 一般来说，算法有两种方式调整稳定币的供应，以纠正供需之间的不平衡：**当稳定币价格上升时，算法会增加稳定币的发行量；当稳定币价格下降时，算法会减少稳定币的发行量。**

> AMPL 算法如下：
> - 如果一个价值 1 美元的稳定币跌破 0.96 美元，该算法可以自动下市场买单，推动价格上涨；
> - 如果一个价值 1 美元的稳定币涨破 1.06 美元，该算法可以自动下市场卖单，降低价格。
> 在实践中，AMPL 的每日回调限额是固定的，用户钱包中的 AMPL 将在设定的时间内 inflate or deflate
>  AMPL 价格上涨→AMPL 供应增加→AMPL 价格下降。

由于早期的稳定币流通量很低，因此容易通过注入资金（将需求曲线向右移动，推动价格上涨）以低成本提高价格，从而导致更多稳定币的发行。


**"死亡螺旋"的流程介绍：**
1. 将新发行的稳定币分配给持币人，然后他们在价格足够高时出售额外的稳定币，从而获得可观的利润。
2. 随着 AMPL 的市场流通量变得足够大，投机基金操纵价格的成本变得更高
3. 当投机者开始出售他们的稳定币并退出该项目导致需求减少，AMPL 的价格随之下降。
4. 随着价格的下降，系统的反身性进一步推动了价格的下降，促使更多的资金离开市场，形成了一个 "死亡螺旋"，直到市场需求稳定下来。

2021 年的时候随着资金进入，AMPL 达到 4 美元
随着 AMPL 的市值逐渐增大，AMPL 的拉盘变得非常困难，投机者便开始出售 AMPL
短短几天内 AMPL 的市值暴跌，后期长期出现 AMPL 价格稳定但市值不稳定的状态
如 AMPL 的价格处在 1 美元，但由于供给量大大的通缩了（买的 10 wU 变成了几千个），因此 AMPL 没办法用作存储使用，只能用于投机拉盘

### **Frax -- 部分质押算稳币/Partial backed algorithmic stablecoin**
Frax (FRAX)是一个部分算法化的稳定币，其供应量
	- 部分由抵押品 (USDC 和 FXS)支持
	- 部分由算法稳定
	抵押比例取决于 FRAX 稳定币的市场价格 - 
		- 如果 FRAX 的交易价格超过 1 美元，协议将减少抵押比例
		- 如果 FRAX 的交易价格低于 1 美元，协议将增加抵押比例。
Frax Share (FXS)是 FRAX 的非稳定的 ERC-20 治理代币，其用途如下：
1. 治理：FXS 授予代币持有者治理权，可以添加/调整抵押资产池，设置铸造/兑换费用，并更改抵押比例更新率
2. 委托：FXS 可以委托到各种池中赚取按年利率 (APY)计费的奖励金
3. 铸造和兑换：在铸造 FRAX 时会销毁 FXS，在兑换 FRAX 时会铸造 FXS
4. 奖励：持有者将 Uniswap LP 代币委托到某些激励池中，可以获得 FXS 奖励

**Example:**
> <span style="background:#930098">假设：</span>
> - <span style="background:#930098">当前持有 100 USDC，质押率=75%，FXS Price = $7</span>

| $25\%\ *\$1\ *100$ | = | $\$7*FXS*75\%$ |
| :------------------------------------------: | :------------: | :------------: |
| FXS required |  =  | 4.76 |
| # of Frax minted |  =  | Frax amount + stable amount |
| |  =  | $\$1*100+\$7*4.76$ |
| |  =  | 133.32 |
- FXS 的价格越高，则 mint 时需要购买的 FXS 数量就越少
- 则 CR 越小，每 100 USDC 可以 mint 的 Frax 数量越多
因此 FXS 的大部分底层资产都是 USDC，3 月份 USDC de-peg 的时候 FXS 的价格也随之暴跌

### UST
*UST 与传统的使用抵押比例的稳定币不同，作为一种算法稳定币依靠激励机制和弹性供应机制来维持 UST peg 1 美元。*

- 机制：UST 的价值通过代币 LUNA 的机制来维持。该协议允许 LUNA 持有者根据 UST 相对于其锚定价值过高或过低来交换 LUNA 与 UST。该机制通过响应市场状况铸造和烧毁 LUNA 与 UST 来维持 UST 的稳定性。

- 通胀（Inflation）：

|         如果：1 UST = 1.01 美元             |   UST 相对于锚定价值过高    |
| :------------------------------------------: | :------------: |
| 协议允许 LUNA 持有者用价值 1 美元的 LUNA 兑换一个 UST | LUNA 被销毁或从流通中移除、UST 被铸造或引入流通 |
|     交易者可以赚取 0.01 美元的利润     | LUNA 供应量下降、价格被推高 |

- 退缩（Deflation）：
  
|         如果：1 UST = 0.99 美元             |   UST 相对于锚定价值过低   |
| :------------------------------------------: | :------------: |
| 协议允许 UST 持有者用价值 1 美元的 UST 兑换一个 LUNA | UST 被销毁或从流通中移除、LUNA 被铸造或引入流通 |
|     交易者可以赚取 0.01 美元的利润     | LUNA 供应量增加、价格被下挫 |

在此系统中 UST 价值恒定被视为 1 美元，LUNA 被储存在 treasury 中以维持 UST 的稳定性。
**Summary**
UST 机制在理论上聪明，但过于依赖供需稳定。一旦供给需求偏差过大就很难自动实现平衡。面对重大市场冲击，系统会难以自我调节从而导致了惨重的失败。
当 UST 和 Luna 同时在暴跌的时候，整体的稳定性就会难以维持。\
# 4. AMM and DEX
## 4.1. CEX & DEX
- **中心化交易所 CEX:** 中心化交易所有大量的用户，他们会提交买单和卖单，进而为代币形成双向报价。
	- 所有人的订单 (order)会汇集成一个订单簿 (ordrer book)，产生一定的交易深度和币种的流动性。
	- 订单类型：
		- Market Order 市价订单
		- Limit Order 限价订单 (limit sell $12, 30)->($13.45~$13.41)
		- Stop-Sell Order 平多止损
		- Stop-Buy Order平空止损
- **去中心化交易所 DEX：** 交易者可以在 Uniswap 执行去信任化的以太坊代币 (ERC token)交换。与此同时，所有人均可将持有的数字货币质押到特殊的资金储备库，即流动性资金池，并因此获得相应的费用作为回报。交易者只能看到价格，看不到订单。只要价格合适就可以进行交易
	- Liquidity Pool: 流动池
	- Liqudity Provider (LP): 流动性提供者
	- LP token: 提供流动性后，获得的凭证代币。
	- LP可以用这个凭证赎回池子里等比例的两种代币
## 4.2 自动做市商/Automated Market Maker（AMM）
>[!tip]
>- 传统做市商 (MM)：就是通过提供买与卖的报价，为金融资产在市场上提供流动性。提高交易平台的交易量，保证交易深度以及促进交易。在传统的交易所中，做市商通常是符合资格的机构。
>- 自动做市商 (AMM)：先让流动性提供者质押两种价值一样的代币 (pair)，并且产生交易价格。再让交易者进行交易。通过后期不断的调整配比，来保证兑换价格的合理性。
### 4.2.1. 恒定乘积公式
>[!tip] 目前主流的 AMM 模型是固定乘积模型:  $x*y=k$

>[!Example] 
>- 假设一开始 ETH 的价格为 3000 USDT，此时一个 100 ETH 的流动性需要存入 300,000 USDT
>- 当有人购买了 5 个以太币时，流动池的以太币数量下降到 95 个，USDT 数量上升，此时 K 值不变。
>- 注意，在购买了池子中 5%的 ETH 后，ETH 的价格变成了 $315,789/95=3324$

- **手续费：** 在实际应用上，Uniswap 还需要买方支付 0.3%的手续费，手续费收入会给到 LP 提供者。越活跃的交易对，LP 占比越大，你能分到的手续费越多。手续费激励了大家去提供流动性
- **Price Impact：** 当用户大量买入，或者卖出的时候，实际成交的均价要高于或者低于初始价格。*E.g. 原来 ETH 的价格是 3000 USDT，在买入 5 个 ETH 的时候，用户实际支付的是 315,789 USDT (+ 0.3%手续费)。所以实际购买成本要高于 3000*
### 4.2.2. 无常损失
定义：无常损失指的是代币价格偏离造成的损失
>[!Example] 
>- **假设 ：** Uniswap 资金池中存入 1 枚 ETH 和 100 枚 USDT，占有 10%的份额。此时总流动性为 10000。
>- **如果 ETH 的价格升至 400 USDT**，此时资金池由 5 枚 ETH 和 2000 枚 USDT 组成，但总流动性仍为 10000。
>- 如果用户决定提取资金将按份额获得 10%，即 0.5 枚 ETH 和 200 枚 USDT，总价值为 400 USDT。相比于不存入的 500 USDT 亏损。

与持有资金相比，将资金存入 Uniswap 池对 Alice 来说更有利。这是因为存入资金池会导致无常损失，即错失其他盈利机会的机会成本。*无常损失不论价格上涨还是下跌都会发生。这意味着，如果 ETH 价格下跌，损失可能会更大。*
这种损失称为无常损失，是因为如果代币价格恢复到存入时的水平，损失可能会减轻。此外，由于流动性供应商可以赚取费用，随着时间的推移，损失可能会得到抵消。
无常损失是指流动性提供者由于价格偏离而遭受的损失。选择“无常”一词是因为如果价格偏离被纠正，损失可能会被减轻。
### 4.2.3. Uniswap
- Uniswap 的优势
	- 中心化交易所一般都是依赖于订单簿（order book）来完成交易
	- 而去中心化交易所，通过 AMM 机制，可以无需订单簿，就能完成交易
	- Uniswap 选择了恒定乘积作为 AMM 机制，让用户可以自己添加池子，完成交易。
	- 去除了订单簿之后，做市商的门槛大大降低了。每个用户，都可以在某个时刻，作为某个交易对的流动性提供者。目前 uniswap 全平台日均交易量已经突破亿美元，LP 提供者每天能获取不低的手续费收入
- Uniswap 的劣势
	- 使用 Uniswap 时，如果流动池资金较少，而交易的金额较大，交易者要承担较大的滑点 (price impact)
	- 以太坊上运行智能合约需要支付 gas，虽然 uniswap 的设计足够精简，但是仍要支付接近 100 美元每次的 gas 成本（不包含 0.3%手续费）
	- 为 Uniswap 等去中心化交易平台提供流动性时，可能会承受“无常损失”
#### UNI
>[!TIP] UNI 是 Uniswap 协议的原生代币，为持有者赋予治理权。这仅仅意味着 UNI 持有者可以对协议变更投票表决。
- 初始铸造总量为 10 亿枚，其中 60%由现有的 Uniswap 社区成员共享，其余 40%将在四年内发放给团队成员、投资者和顾问
- 社区发放中发放给了以下 Uniswap 资金池提供流动性的供应商: ETH/USDT、ETH/USDC、ETH/DAI、ETH/WBTC
- Uniswap 中提供流动性的风险
	对流动性提供者（LP）而言，无常损失来自于单边波动——使无常损失成为永恒，而围绕均值回归的波动，越猛烈，收取的交易费越高。因此，在没有项目代币激励的情况下，做 LP 其实是在赌短期内：
	○ 两种资产价值比不会发生太大变化，避免遭受无常损失
	○ 交易活跃，池子收取大量交易费。
![[content/notes/images/1703673522946.png]]
赚钱友好度的交易对
#### 固定乘积的问题
- 恒定乘积函数的好处：它能确保任何一种资产在任何价格都有流动性，这也是 Uniswap 的繁荣基础——山寨币的繁荣。
- 恒定乘积函数的坏处：资本利用效率被无限的价格区间摊薄而降低：
- 对用户而言，交易额越大，跨越的价格区间越大，价格越是偏离，滑点越高——导致损失越大，损失本质来源于 $X*Y=K$ 曲线的特性，价格越偏离，套利空间越大，其有促进均值回归的作用。
- **滑点巨大的问题:** 大额交易要承担很大的 price impact
- 在池子中 ETH 很少的时候，ETH 的价格可能会非常非常高
![[content/notes/images/1703673875499.png]]
- 在稳定币的兑换中，固定乘积模型非常不实用。
- 本来应该是1:1的兑换，实际兑换的成本是 1.11:1，你获得的 USDC 更少了。
- 若采用恒定总和函数 $X+Y=K$，则简单地实现了低滑点，但同时很容易被抽干流动性，无法起到做市商的作用
### 4.2.4. Curve Finance
>[! TIP] Curve 优化出了无法拒绝的低滑点，低手续费，低无常损失风险。
- Curve Finance 采用结合了恒定总和和恒定乘积函数创造的混合 AMM：在曲线的平衡点附近创建一条相对平坦的曲线，类似于恒定总和函数，以保持价格相对稳定，同时使两端更加倾斜，类似于恒定乘积函数，因此在曲线的每个点都有流动性
![[content/notes/images/1703674083785.png]]
#### Curve 代币--CRV
- 正如前文分析，Curve 的交易手续费、滑点以及无常损失风险远低于目前主流的 Dex，由此产生的问题是分给 LP 的手续费也远远低于其他 Dex，那么 Curve 如何依靠其吸引 LP 们源源不断地注入流动性呢？
- **Curve 的独特的激励机制：** 通过提供质押金额和时间确定的 CRV 代币奖励
	- 自 2020 年 8 月开始，Curve 通过启动 DAO 从而开启了去中心化治理之路。同其他 DAO 一样，CRV 作为 Curve DAO 的治理代币，赋予了代币持有者社区治理的投票权和治理权。CRV 既可以从二级市场直接购买也可以通过流动性挖矿获得，即在 Curve 提供流动性不仅可以获得交易手续费收益，同时也可以获得奖励的 CRV 代币。LP 们在获得 CRV 奖励的同时也拥有了 Curve 协议的 DAO 治理权。
	- 锁定 CRV 可以根据时间加权获得投票代币 veCRV，锁定时间越长，投票权重越大。目前，锁四年才能获得1:1 的 veCrv，获得投票权以及所有池子一半交易费（0.04%÷2=0.02%，按照锁仓比例） 。除此以外，持有 veCRV 还可以获得很多同系项目的空投 (比如 Ellipsis）
# 5.  Yield Farming/流动性挖矿
>[!tip] Yield Farming，中文名为“流动性挖矿”是一种通过所持数字货币产生奖励的方法
>流动性挖矿的核心是管理策略，把现金存入在银行账户的投资者不属于 DeFi 挖矿，因为这不涉及管理策略。但是不断转新的银行并开设新的高收益储蓄账户，赚取奖金和享受折扣的行为可以是Yield Farming。
- 流动性挖矿的特点：
	- **需要经常管理的被动策略**：投资者必须不断寻找策略、管理风险和调整投资仓位。但一旦找到了适合参与的挖矿机会，投入资产就会获得回报，几乎不需要后续的操作。
	- **有明确的收益率**：DeFi 挖矿与买入并持币待涨这两种策略最大的区别就是：“炒币”没有任何明确的利息收益。
	- **额外收益**：可以在持有现货仓位的同时获得额外回报的一种方式。
## 5.1. 流动性挖矿的不同形式 - 网络节点运营
- **传统节点验证者**：他们处理交易以换取网络原生代币，保障加密网络中最基本的功能是正确安全地运营网络。许多网络依靠*计算密集型来激励运营行为（POW 网络）*，也有很多网络则依赖于*抵押品的验证者（POS 网络）*。如果验证者表现不佳或行为不端，该抵押品可能会被部分或全部没收。
- **流动性挖矿网络节点运营**：投资者将代币委托给高质量的验证者，即可靠和诚实的验证者，以换取收益的一部分。如果投资者把代币分配给低质量的验证者，这些验证者可能面临负面后果，即没收抵押品，投资者将承担这个后果。
>[!Example] 
>1. Coinbase 上的交易者可以选择在平台上质押 ETH，即将他们的 ETH 委托给 Coinbase，因为它参与将以太坊网络升级到以太坊 2.0，以换取大约 5% 的年化利息。
>2. Avalanche 交易者可以使用 dapp 来质押他们的 AVAX，即将他们的 AVAX 代币委托给处理 Avalanche 网络的几个不同验证者之一，以换取奖励。
### 价值思考
- 经济价值：DeFi 投资者将他们的资产分配给高质量的验证者，让网络更高效、更安全地运行。
- 报酬：奖励由网络参与者支付，他们向验证者支付费用以换取使用网络的权益，然后验证者将这些费用的一部分汇回给投资者。
## 5.2. 流动性挖矿的不同形式 - 提供贷款
- 投资者将代币放入资金池中，借款人使用抵押品从这些池中借款。这些协议（Aave 和 Compound）通常接受基础资产作为存款（B/E)。这些协议通过向贷方发行新的合成代币（例如，cUSDT）来跟踪存款，借贷方可以使用它来赎回原始代币和应计利息。
- **缺点：** 由于目前几乎所有协议都专注于超额抵押贷款。因此借贷方面临*抵押品贬值速度超过清算速度的风险。*
- **未来：**
	- TrueFi 和 Goldfinch 等一些协议正在通过审查借款人，了解他们一些链下现实世界信息信息，扩展到无抵押贷款领域。
	- 未来的 DeFi 投资者可能会在借贷协议间做出选择，接受完全抵押贷款或者直接承担借款人的违约风险。
### 价值思考
- 经济价值：DeFi 投资者将代币出借给有需要的交易者，这使这些交易者能够更有效地表达对资产价格的看法。未来，DeFi 投资者还可以通过将代币分配给更高质量的借款人和项目来提供价值。
- 报酬：投资者得到的回报是借款人不断支付利息（协议本身也回收取一部分）。虽然一些协议暂时保证固定利率，但大多数协议按照供需的给出浮动利率。
## 5.3. 流动性挖矿的不同形式 - 提供流动性 LP
- **定义：** 投资者将加密货币存入 AMM。交易者可以利用这些流动性池子交换代币 —— 通常除了滑点之外还要支付明确的费用。
- **缺点：** 流动性提供者通过促进双向流动性赚取这些手续费 / 或价差，但如果基本汇率发生变化（行情波动），也会承担资本损失的风险。
- **项目：** 为 DeFi投资者运行流动资金池的主要协议示例包括 Curve、Uniswap、Sushiswap 等。这些流动池作为链上流动性中心，促进许多不同资产对之间的交易。
### 价值思考
- 经济价值：DeFi 投资者为需要流动性的人提供流动性，使他们能够以最小的市场影响价格交易代币。
- 报酬：我们需要注意的是，流动性提供者通过三种方式获得奖励。首先，AMM 将直接奖励（即交易费用和点差）分配给流动性提供者。奖金由从池中获取流动性的用户支付。其次，以自己的原生代币发行奖励，例如 Uniswap 发行 UNI 代币。除了直接的经济价值外，这些代币通常还带有特殊的奖励计划（治理权）。
## 5.4. 流动性挖矿的不同形式 - 聚合器
在引导资本方面。一种逐渐流行的策略是透过聚合器，以委托的方式管理代币。
>[!Example]
> - Convex 协议把 Curve 平台上的流动性引导到流动性池方面非常成功。
> - Yearn 协议在也取得了类似的成功，在多个借贷和流动性协议中分配资产。
*这提醒我们，单一的收益耕作策略可能以多种方式提供价值。例如 DeFi 投资者可以直接在 Curve 上提供流动性，也可以通过 Convex 在 Curve 上提供流动性。他在这两种情况下都因提供流动性而获得奖励，但在后一种情况下更高效地提供流动性而获得额外奖励。*
### 价值思考
- 经济价值：使用 Convex 和 Yearn 时，这些协议可以比单一质押的交易者更快、更便宜地将流动性重新分配到特定市场。
- 报酬：投资者得到明确和隐含的奖励： 首先，投资者通过将资源投入到高价值协议来获得更好的回报。然后，他们会得到用户的奖励，例如借款人或流动性利用者。 其次，投资者通过使用此类协议节省了交易成本。(以太坊网络上的转账费用有时会超过每笔 100 美元，机枪池协议均摊了这些费用，因此可以更频繁地调整投资组合。) 投资者还可以通过自动化的投资组合管理，节省个人工作量，协议自动识别并将资金转移到当前的最佳机会。
## 5.5. 流动性挖矿的不同形式 - 提高知名度
>[!tip] DeFi 投资者提供的最终价值是通过抵押资产为项目提高知名度和信任度，协议要求投资者购买和锁定代币以换取代币分配 —— 锁定时间越长，奖励越大。当然，锁定持有者无法对行情波动做出预测，相对于流动性持有者承担大的价格风险。
- DeFi 投资者为协议提供更高的 TVL 从而提高奖励。
- DeFi 投资者通过协议获得奖励，该协议通常以原生代币形式提供奖励。这意味着，在短期内，非投资者通过承担通货膨胀负担来支付这些奖励。但是，从长远来看，该协议希望成功地创造价值和吸引新用户。
- 在这种情况下，后期持有者为早期Yield farmer的营销活动付费。 从概念上讲，这个渠道是最模糊的，最容易出现庞氏骗局。事实上，协议必须解决关键问题，例如在隐性营销预算结束后它们是否可以留住用户。但传统市场的创业界有一些成功的先例，「闪电式扩张」—— 风投资助的创业公司在提高价格之前大量补贴用户以获得市场份额的策
### 价值思考
- 尽管有许多变化，但其核心的 Yield Farming 策略相当简单: 投资者被动地为协议提供价值，以换取直接和间接奖励。然而，随着发展出现了一个最终因素：金融化。Crypto 开发了一个强大的金融协议生态系统，允许 DeFi 投资者自由转移资产并使用杠杆。
- 这就是有多少 DeFi 投资者将基础单倍收益增加到更诱人的水平（例如 20% 到 100%）。上节课的例子：流动性质押。这是投资者将基础代币存入协议并接收合成凭证代币的地方。只要凭证被其他借贷协议接受为抵押品，投资者就可以利用他们的凭证代币。即投资者可以存入基础代币（例如 ETH），接收代表该声明的合成代币（例如，stETH），借用该合成代币作为抵押品的 ETH，存入该 ETH，接收 stETH 等。这个顺序不是唯一的，做空或细分的功能给资产组合增加了更多的复杂性。但重要的是要强调，虽然金融化可以增加收益，但基本理论是一样的。投资者因承担风险和被动提供价值而获得奖励，而金融化则将生态系统的不同部分连接起来，并放大了风险和回报。
# X. DeFi 项目 


---
BackLink： [[content/1-Crypto/0. Crypto Index|0. Crypto Index]]