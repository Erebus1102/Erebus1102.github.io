---
title: "深入理解蓝筹协议"
tags:
- Web 3.0
- Crypto
- Financial Transaction
---
>[!info] Defi 市场需要解决什么问题：
	- Savings and Borrowing「存款贷款的需求」:
	    - Secure deposit and saving options for entities with interest earnings.
	    - Access to loans and credit facilities based on collateral and creditworthiness.
	- Equilibrium between Savings and Borrowing「确定加密市场的原生利率」:
	    - Determining interest rates that balance the supply of savings with the demand for borrowing.
	- Asset Trading「资产交易」:
	    - Ability to transfer various assets across entities and time.
	    - Support for trading cryptocurrencies, tokens, stocks, commodities, and financial instruments.
	    - Spot trading for immediate exchanges and futures trading for specified future dates.
	- Risk Management「风险管理」:
	    - Integration of hedging, insurance, and risk mitigation tools.
	    - Protection of user investments and portfolios through decentralized insurance products and derivatives.
# 1. Stablecoin and Lending Protocols
- **稳定币的定义：** 稳定币是在区块链上发行的数字代币，与传统货币挂钩，保持相对稳定的价值
- **稳定币的主要目标：** 减少价格波动，使交易和结算能够以美元计价在某些交易所和去中心化交易所进行
- **稳定币的交易环境：** 以美元计价在某些交易所和去中心化交易所进行
- **稳定币的现状：** 目前加密货币市场上有50多种稳定币，泰达币（USDT）和 USDC 是市场份额最大的两种稳定币，其中 USDT 在交易者中特别受欢迎
## 1.1. Fiat-backed 法币抵押
>[!info] 
>- Risk/相关风险：
>	- Counterparty risk
>	- Government regulation
>	- Freezable
>- Benefit/相关益处：
>	- The most stable
>	- The most scalable
>	- Easy to track

稳定币系统可以想象成一个全储备银行系统（full-reserve banking system），在全储备银行中，每个负债都与储备资产以1:1的比例匹配。如果持有数字美元的人想要兑换成现金，银行将提供实体美元并"销毁"相应的数字债务。
- 资产负债表的左侧是银行的实际资产，即作为储备的实体美元。
- 资产负债表的右侧是银行的负债（"数字美元"），即对储备资产的索取权。
## 1.2. Crypto-backed 加密资产抵押
>[!info] 
>- Risk/相关风险：
>	- Less stable
>	- harder to scale
>	- Robustness in large-drawdown
>- Benefit/相关益处：
>	- Decentralized
>	- Censorship resistant

- 如何创建一个以资产储备为基础的稳定币银行：
	1. 用现金资产换取等值的加密货币资产作为储备
	2. 考虑到加密货币价格波动性，1:1的储备比率无法提供充足的保障。如果价格下跌，银行就可能出现负债超过资产的情况
	3. 增加缓冲区以抵御加密货币价格下跌并保护资产。这个概念与 MakerDAO 的模型类似，它会要求借款人质押一定比例的加密资产，这样价格下跌时抵押品仍能覆盖债务。**所以通常加密资产抵押的储备比率会高于1:1（如 110%或 120%），以调控短期价格波动**
	4. 通过这种充分储备的模式，银行能够提供更稳定的稳定币，同时避免负债风险
- Buffer/缓冲区：专业术语为“抵质押比率”，它决定了每一个单位的稳定币需要多少加密资产作为抵押支撑。「例如, 150%的抵质押比率意味着每 1 美元的流通稳定币，至少需要价值 1.5 美元的加密资产作为抵押」。
	- 这种设计保证即使加密货币价格下跌，抵质押资产的价值也能支持稳定币的价值。这样稳定币可以保持债务稳定，银行也可以保持充分抵押状态。
### DAI
>[!info] 
>USDT\USDC 所存在的问题与传统金融行业中的问题相似，法币抵押稳定币的价格依赖于社会体系以及法律体系。
>	若银行资产被冻结、审计、会计存在欺诈行为等等（如 SVB），则用户手中的稳定币就变成了 “I own you” 的借条，因此法币抵押也被称为 “IOU” 模式。
>	同时当区块链上的公司计划实行相同的模式时，会引入非常多不被信任的中间商（会计、审计等）这样的机制不太符合 Web3.0 “去中心化自治” 的要点。
	- Dai 是通过抵押加密资产在 MakerDAO 平台上发行的稳定币。
	- Dai 与美元挂钩（peg），所以1 Dai 等于1美元。

- **CDP/Collateralized Debt Position**：MakerDao 的核心机制是担保债务头寸(CDP)。
	- 假设申请者向银行申请房贷，申请过程中使用房产作为抵押，银行提供现金贷款。如果房产价值下降，则银行将要求申请者偿还贷款。如果申请者无法偿还贷款，银行将收走您的房产。
	- 对 Maker 来说，以太坊就像房产，智能合约就像银行，Dai 就像贷款。ETH 持有者将以太坊存入 CDP 智能合约，并获得 Dai 作为贷款。如果持有者抵质押的以太坊价值下跌至一定阈值以下，要么像银行贷款那样偿还智能合约贷款，要么智能合约收走以太坊并竞拍出售。

- **如果以太坊价值下跌：** 如果抵质押的以太坊价值无法支持相应数量的 Dai,Dai 价值将低于1美元,系统可能崩溃。
- **如果以太坊价值上升：** 抵质押率将增加，Dai 价值也将上涨。如果 Dai 交易价格超过1美元。Maker 通过机制激励用户创建更多 Dai。
	解决方法：Maker 将在所持有的 ETH 价值无法支持 Dai 价格前清算 CDP，并将以太坊竞拍出售。
		如果 CDP 中的价格显示 ETH 价值下跌至创建 Dai 代币对应的一定阈值(比如125%)以下，CDP 将被“清算”，CDP 中的以太坊将竞拍出售（Auction Process）直到偿还借出的 Dai 为止。
- Auction Process：
	- 生成 DAI 后，Vault 的所有者可以收回 DAI 从而提取质押的数字资产。此时收回的 DAI 也将被系统销毁，以维持抵押品价值和流通中的 DAI 价值之间的平衡。
	- 在销毁-回收流程之前。必须支付稳定费/Stability Fee（可以理解为贷款的利息/interest on the loan）

	> **Example:**
> <span style="background:#930098">假设：</span>
> - <span style="background:#930098">Stability fee = 2% (这笔钱收取后会存放到 Buffer Pool 中，Buffer Pool 不属于任何人，Work as reserve fund)</span>
> - <span style="background:#930098">Collateralization Ratio 联合质押率 = 150%</span>
	- 初始状态：$1\ ETH = \$ 3500 = generated => 2000 DAI$ 
	- **若：** $1\ ETH 下跌到 \$\ 2900$ ，则此时 1 Ether 能铸造的最大 DAI 数量为：$2900/150\% = 1933$ 
	此时生成的 2000 个 DAI 超过了系统允许的 1933 个，则此 Vault（CDP）就将被清算来还掉欠的 2000 个 DAI，**同时还需要缴纳一笔清算的罚款** （13% ~ 33%，该区间由 MKR token holders 投票决定）。
	具体的罚款值由拍卖的单价决定，拍卖价格越高，持有者的损失越少，则罚款也就越少。
$$
\begin{gather}
the\ liquidation\ price = number\ of\ DAI * liquidation\ ratio = 2000 * 150\% = $ 3000 \\
即：当以太坊的价格跌至3000以下的时候，系统就将进行清算\\
the\ liquidation\ penalty = least\ 13\% * the\ liquidation\ price = 3000*13\% = 390\ DAI\\
total\ outstanding\ debt = the\ liquidation\ penalty\ +\ number\ of\ DAI  = 2000+390 = 2390\ DAI\\
机制目的: Total\ Colleteral > Total\ outstanding\ debt
\end{gather}
$$
要求确保出价能够覆盖负债，因此整个拍卖过程包含两个阶段：

| Phase 1 “Setting Price” (保证债务能 Cover)   | Phase 2 “negotiation” (减少被清算者损失)     |
| ------------------------------------------- | -------------------------------------------- |
| 2000 DAI for 1 ETH                          | For 2390 DAI, 出价 0.95 ETH                   |
| 2200 DAI for 1 ETH                          | For 2390 DAI, 出价 0.90 ETH                   |
| 2400 DAI for 1 ETH -> 满足 outstanding debt | For 2390 DAI, 出价 0.87 ETH -> 没有更低出价者 |

假设此时出价者通过 0.87 ETH，拍卖得到 2390 个 DAI。其中 2000 DAI 被用于还款，而 390 DAI 被用于缴纳罚款。此时竞拍者获得的 ETH 的实际价值高于 2390 DAI 或对应的每 ETH 高于 $2390/0.87 = \$2747 $，而此时ETH的售价为$ 2900，则此时竞拍者获利。

------

**罚款比例的计算：**

在本次清算（Liquidation）中，持有者将一个 ETH（价值\$3000）生成了 2000 DAI，而清算结束后他持有 2000 个 DAI 和 0.13（价值\$390）个 ETH，总亏损为 $\$610\  (=3000-2000-390)$，此时的罚款比例为 $20.33\%\ (=610/3000)$。

如果想进一步降低被清算者的损失，假设有竞拍者使用 0.797 个 ETH 拍得 3000 个 DAI，则此时的罚款比例达到了最低的 13%。

而如果在第一阶段叫到 2390 DAI 便结束，而第二阶段无人继续叫价，则用户会面临 Full liquidation (利用 1 ETH 全部偿还 2390 DAI)，此时他将拥有 2000 DAI 和 0 ETH，总损失 1000，罚款比例为 $33\%\ (=1000/3000)$。

------

**当以太坊继续暴跌的情况下…：**

若以太坊继续暴跌，假设一阶段最高报价为\$1500，则此时 CDP 全部清空后持有者将持有 2000 DAI + 0 ETH，而此时系统的 OutStanding Debt 为 $\$890 DAI (=2390-1500)$。此时 Vault 中没有任何资产可以用来清算，而系统处于欠债情况，则此时需要 Buffer Pool 参与工作。

系统会将 Buffer Pool 中对应金额的 DAI 拿出来销毁掉以补足欠债；

当 Buffer Pool 中的 DAI 依然不足以偿还债务的时候，Debt Protocol 会被激活。系统会生成 MKR 代币进行拍卖，直到拍卖价格补足 Outstanding debt。

> Q：那 MKR 是否就是没有价值，只是机构用于印钞抵债的骗局工具的呢？
> A：当正常情况下，Buffer Pool 通过 Stability fee 和 Liquidation Penalities 是在不断积攒的，在这种情况下机构会从 Buffer Pool 中取出 DAI 来购买流通市场上的 MKR 并销毁掉，从而保证流通市场上 MKR 的价值属性。

------

**The DAI Saving Rate （DSR）：**

用户可以将自己持有的 DAI 存入 DSR 合约中来赚取利息，其实就是将 DAI 存入 Buffer Pool 中来积攒机构的风险抵抗能力，同时可以鼓励用户持有 DAI；

当市场上的 DAI 流通量过高导致 DAI 的单价低于 $1，机构可以提高 DSR 的利率来吸引用户将 DAI 存入 Buffer Pool，通过这种方式降低市场上的流动率从而提高单价；相反当 DAI 的单价过高的时候，机构可以选择降息。

##### MakerDAO 的发展历史

* **Peg Stability Module（PSM）与 MakerDAO 在 2023/3 脱锚的原因**
	- MakerDAO 的 PSM 是：一种允许用户以零成本将法币支持的稳定币与\$DAI 交换的工具；
	- 使用 PSM 模块不会将你的法币支持的稳定币抵押在金库中，而是直接将它们兑换成\$DAI，用户也可以将\$DAI  兑换成 PSM 模块，并获得法币支持的稳定币；
	- PSM 加强了\$DAI 和美元之间的联系，允许 Traders 利用\$DAI 和其他法币支持的稳定币之间的价格差异套利；

  PSM 改变了 MakerDAO 的资产负债表。

|                    Asset                     |   Liability    |
| :------------------------------------------: | :------------: |
| Loan from minting DAI (secured by ETH, WBTC) | DAI (from CDP) |
|     Fiat-backed stablecoins (USDC, USDP)     | DAI (from PSM) |

  * **PSM 的问题：** 由于现在生成 DAI 的对应资产中 37.2%（最大份额）是 USDC（通过 PSM）直接兑换而来，而 USDC 的 Swap 并不能像 ETH/BTC 一样产生 Stability fee 和 Penalty fee，从而导致 DAI 也承受 USDC 的风险。

    即：如果 USDC 收到影响，而大量的 Swap 过程没有给 Buffer Pool 带来足够的增量，DAI 也会承受来自 USDC 的压力。

  * **PSM 的补足手段：**

    由于 PSM 工具的 Allowance 有一个 hardcap 上限，当达到这个上限的时候用户只能用 1 DAI 换 1 USDC，但不能用 1 USDC 换 1 DAI，这确保了 DAI 的数量不会疯狂上涨造成贬值，从而确保了 DAI 的价值不会低于 USDC 的价值；

    Example：有非常多的交易员通过做多 DAI，做空 USDC 来赚取价差。只要 USDC 价格跌幅大于 DAI 的价格跌幅，这之间的差距就可以保证该策略有效盈利。

    如果 USDC 贬值（如\$0.98），MakerDAO 通常会增加铸币费来维持 USDC 与 DAI 直接价格的锚定（即增加 PSM 工具的使用费用来注入 Buffer Pool）。在某些情况下，MakerDAO 可能需要吸收与这些债务有关的损失，以确保 DAI 价格的稳定。
    在极端情况下，如市场崩溃，借款人可能会购买 DAI 来偿还他们的债务。这将导致对 DAI 的需求大幅增加，从而推高其价格。在这种情况下，PSM 可以帮助平衡市场，提供一种机制，允许用户以固定利率交换 DAI 和 USDC，从而促进 DAI 价格的稳定。

* **RWA  （Real World Asset）**
  * RWA 是 MakerDAO 的一种新概念，它代表了 MakerDAO 投资于现实世界资产的价值。
  * 考虑到$USDC 是由美元存款和美国政府债券支持的，直接投资于美国政府债券可以减少风险，并且基本上价值相似的资产。
  * MakerDAO 设计了一个信托结构来间接持有现实世界的资产，这样做可以降低 MakerDAO 的风险，并增加其收入。
  * MakerDAO 的 RWA 概念的 token 是 MKR，它是一种能够给协议带来盈利能力的 token。

## 1.3. Algorithmic Stablecoins 算法稳定币
>[!info] 
>- Risk/相关风险：
>	- Highly theoretical and not tested out in practice
>- Benefit/相关益处
>	- Potentially decentralized：
算法稳定币使用价格稳定算法来跟踪一个特定的单位价格，通常是 1 美元，并在以太坊（ETH）等基础加密货币支持的区块链上运行。

- 算法稳定币的价格由基于智能合约的市场和技术机制支持，这些机制锁定了加密货币抵押品并实施价格稳定算法。
- 与其他类型的稳定币不同，算法稳定币不能以1:1的比例兑换美元，也没有其他加密货币资产的支持。它们通常表现出高度的反身性。
- 对算法稳定币的需求主要由市场情绪和趋势驱动，这也影响到代币供应。Ampleforth（AMPL）是目前运行时间最长的算法稳定币。

### **AMPL:**

- AMPL 的代币供应量根据目标资产的价格变化而变化（这种机制被称为 "rebase"）。
- 代币供应的变化会影响到持有算法稳定币的每个账户。"rebase"通常发生在预定的时间间隔内，使算法稳定币网络具有高度的反身性。
- 一般来说，算法有两种方式调整稳定币的供应，以纠正供需之间的不平衡：**当稳定币价格上升时，算法会增加稳定币的发行量；当稳定币价格下降时，算法会减少稳定币的发行量。**

> Example：
> 一个非常简单的回溯算法可以设计如下：
> - 如果一个价值 1 美元的稳定币跌破 1 美元，该算法可以自动下市场买单，推动价格上涨；
> - 如果一个价值 1 美元的稳定币涨破 1 美元，该算法可以自动下市场卖单，降低价格。
> 在实践中，AMPL 的每日回调限额是固定的，用户钱包中的 AMPL 将在设定的时间内 inflate or deflate
>  AMPL 价格上涨→AMPL 供应增加→AMPL 价格下降。

由于早期的稳定币流通量很低，因此容易通过注入资金（将需求曲线向右移动，推动价格上涨）以低成本提高价格，从而导致更多稳定币的发行。


**"死亡螺旋"的流程介绍：**
1. 将新发行的稳定币分配给持币人，然后他们在价格足够高时出售额外的稳定币，从而获得可观的利润。
2. 随着 AMPL 的市场流通量变得足够大，投机基金操纵价格的成本变得更高
3. 当投机者开始出售他们的稳定币并退出该项目导致需求减少，AMPL 的价格随之下降。
4. 随着价格的下降，系统的反身性进一步推动了价格的下降，促使更多的资金离开市场，形成了一个 "死亡螺旋"，直到市场需求稳定下来。

### **Frax -- 部分质押算稳币/Partial backed algorithmic stablecoin**
Frax (FRAX)是一个部分算法化的稳定币，其供应量
	- 部分由抵押品(USDC 和 FXS)支持
	- 部分由算法稳定
	抵押比例取决于 FRAX 稳定币的市场价格 - 
		- 如果 FRAX 的交易价格超过1美元，协议将减少抵押比例
		- 如果 FRAX 的交易价格低于1美元，协议将增加抵押比例。
Frax Share(FXS)是 FRAX 的非稳定的 ERC-20治理代币，其用途如下：
1. 治理：FXS 授予代币持有者治理权，可以添加/调整抵押资产池，设置铸造/兑换费用，并更改抵押比例更新率
2. 委托：FXS 可以委托到各种池中赚取按年利率(APY)计费的奖励金
3. 铸造和兑换：在铸造 FRAX 时会销毁 FXS，在兑换 FRAX 时会铸造 FXS
4. 奖励：持有者将 Uniswap LP 代币委托到某些激励池中，可以获得 FXS 奖励

**Example:**
> <span style="background:#930098">假设：</span>
> - <span style="background:#930098">当前持有 100 USDC，质押率=75%，FXS Price = $7</span>

| $25\%\ *\$1\ *100$ | = | $\$7*FXS*75\%$ |
| :------------------------------------------: | :------------: | :------------: |
| FXS required |  =  | 4.76 |
| # of Frax minted |  =  | Frax amount + stable amount |
| |  =  | $\$1*100+\$7*4.76$ |
| |  =  | 133.32 |
则 CR 越小，每 100USDC 可以 mint 的 Frax 数量越多

### UST
UST 与传统的使用抵押比例的稳定币不同，作为一种算法稳定币依靠激励机制和弹性供应机制来维持 UST peg 1美元。

- 机制：UST 的价值通过代币 LUNA 的机制来维持。该协议允许 LUNA 持有者根据 UST 相对于其锚定价值过高或过低来交换 LUNA 与 UST。该机制通过响应市场状况铸造和烧毁 LUNA 与 UST 来维持 UST 的稳定性。

- 通胀（Inflation）：

|         如果：1 UST = 1.01 美元             |   UST 相对于锚定价值过高    |
| :------------------------------------------: | :------------: |
| 协议允许 LUNA 持有者用价值 1 美元的 LUNA 兑换一个 UST | LUNA 被销毁或从流通中移除、UST 被铸造或引入流通 |
|     交易者可以赚取0.01美元的利润     | LUNA 供应量下降、价格被推高 |

- 退缩（Deflation）：

|         如果：1 UST = 0.99 美元             |   UST 相对于锚定价值过低   |
| :------------------------------------------: | :------------: |
| 协议允许 UST 持有者用价值 1 美元的 UST 兑换一个 LUNA | UST 被销毁或从流通中移除、LUNA 被铸造或引入流通 |
|     交易者可以赚取 0.01 美元的利润     | LUNA 供应量增加、价格被下挫 |

在此系统中 UST 价值恒定被视为1美元，LUNA 被储存在 treasury 中以维持 UST 的稳定性。
#### Summary：
UST 机制在理论上聪明，但过于依赖供需稳定。一旦供给需求偏差过大就很难自动实现平衡。面对重大市场冲击，系统会难以自我调节从而导致了惨重的失败。

---
# Decentralized （spot）exchange DEX
## 自动做市商/Automated Market Maker（AMM）
做市商(MM)是负责在交易所提供价格的实体，否则没有交易活动就会缺乏流动性。做市商从自己的账户买入和卖出资产，最终目的是为了获利。他们的交易活动为其他交易者创造了流动性，降低了交易的滑点。

自动做市商(AMM)使用算法 "Money Robots "来模拟DeFi等市场内的价格行为。虽然不同的去中心化交易所设计不同，但基于AMM的DEX一直以来都拥有最大的流动性和最高的日均交易量
# Decentralized (perpetual) exchanges
## GMX
## SNX (Kwenta)
## DYDX

BackLink: [[content/1-Crypto/0. Crypto Index|Crypto Index]]